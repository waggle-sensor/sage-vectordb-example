{
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": {
          "uid": "-- Grafana --"
        },
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "type": "dashboard"
      }
    ]
  },
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 0,
  "id": 0,
  "links": [],
  "panels": [
    {
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 0
      },
      "id": 72,
      "panels": [],
      "title": "Health",
      "type": "row"
    },
    {
      "datasource": {
        "uid": "prometheus"
      },
      "description": "Weavloader's Components Health",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "fixed"
          },
          "mappings": [
            {
              "options": {
                "0": {
                  "color": "red",
                  "index": 1,
                  "text": "Dead"
                },
                "1": {
                  "color": "green",
                  "index": 0,
                  "text": "Alive"
                }
              },
              "type": "value"
            }
          ],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "red",
                "value": 0
              }
            ]
          },
          "unit": "bool"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 3,
        "w": 12,
        "x": 0,
        "y": 1
      },
      "id": 16,
      "options": {
        "colorMode": "background",
        "graphMode": "none",
        "justifyMode": "auto",
        "orientation": "auto",
        "percentChangeColorMode": "standard",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "showPercentChange": false,
        "textMode": "auto",
        "wideLayout": true
      },
      "pluginVersion": "12.2.0",
      "targets": [
        {
          "editorMode": "code",
          "expr": "weavloader_component_health{instance=\"$instance\"}",
          "legendFormat": "{{component}}",
          "range": true,
          "refId": "A"
        }
      ],
      "title": "Components Health",
      "type": "stat"
    },
    {
      "datasource": {
        "uid": "prometheus"
      },
      "description": "Shows celery worker’s online status.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "fixed"
          },
          "mappings": [
            {
              "options": {
                "0": {
                  "color": "red",
                  "index": 1,
                  "text": "Dead"
                },
                "1": {
                  "color": "green",
                  "index": 0,
                  "text": "Alive"
                }
              },
              "type": "value"
            }
          ],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "red",
                "value": 0
              }
            ]
          },
          "unit": "bool"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 3,
        "w": 12,
        "x": 12,
        "y": 1
      },
      "id": 36,
      "options": {
        "colorMode": "background",
        "graphMode": "none",
        "justifyMode": "auto",
        "orientation": "auto",
        "percentChangeColorMode": "standard",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "showPercentChange": false,
        "text": {},
        "textMode": "value_and_name",
        "wideLayout": true
      },
      "pluginVersion": "12.2.0",
      "targets": [
        {
          "editorMode": "code",
          "expr": "weavloader_flower_worker_online{instance=\"$instance\"}",
          "legendFormat": "{{worker}}",
          "range": true,
          "refId": "A"
        }
      ],
      "title": "Worker Health Status Timeline",
      "transformations": [
        {
          "id": "renameByRegex",
          "options": {
            "regex": "(.*)@.*",
            "renamePattern": "$1"
          }
        }
      ],
      "type": "stat"
    },
    {
      "datasource": {
        "uid": "prometheus"
      },
      "description": "Timeline of Weavloader's component up/down states. Use this timeline to visually correlate component outages or restarts with other metrics to quickly identify the root cause of pipeline disruptions.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "fixed"
          },
          "custom": {
            "axisPlacement": "auto",
            "fillOpacity": 70,
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineWidth": 0,
            "spanNulls": false
          },
          "mappings": [
            {
              "options": {
                "0": {
                  "color": "red",
                  "index": 1,
                  "text": "Dead"
                },
                "1": {
                  "color": "green",
                  "index": 0,
                  "text": "Alive"
                }
              },
              "type": "value"
            }
          ],
          "noValue": "0",
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "red",
                "value": 0
              }
            ]
          },
          "unit": "bool"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 6,
        "w": 12,
        "x": 0,
        "y": 4
      },
      "id": 69,
      "options": {
        "alignValue": "left",
        "legend": {
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "mergeValues": true,
        "rowHeight": 0.9,
        "showValue": "never",
        "tooltip": {
          "hideZeros": false,
          "mode": "single",
          "sort": "none"
        }
      },
      "pluginVersion": "12.2.0",
      "targets": [
        {
          "editorMode": "code",
          "expr": "weavloader_component_health{instance=\"$instance\"}",
          "legendFormat": "{{component}}",
          "range": true,
          "refId": "A"
        }
      ],
      "title": "Component Health Status Timeline",
      "type": "state-timeline"
    },
    {
      "datasource": {
        "uid": "prometheus"
      },
      "description": "Timeline showing when Celery workers were online or offline; useful for spotting restarts and availability gaps. Use this timeline to monitor worker availability, and visually correlate worker downtime with other metrics to quickly identify the root cause of pipeline disruptions.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "fixed"
          },
          "custom": {
            "axisPlacement": "auto",
            "fillOpacity": 70,
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineWidth": 0,
            "spanNulls": false
          },
          "mappings": [
            {
              "options": {
                "0": {
                  "color": "red",
                  "index": 1,
                  "text": "Dead"
                },
                "1": {
                  "color": "green",
                  "index": 0,
                  "text": "Alive"
                }
              },
              "type": "value"
            }
          ],
          "noValue": "0",
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "red",
                "value": 0
              }
            ]
          },
          "unit": "bool"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 6,
        "w": 12,
        "x": 12,
        "y": 4
      },
      "id": 70,
      "options": {
        "alignValue": "left",
        "legend": {
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "mergeValues": true,
        "rowHeight": 0.9,
        "showValue": "never",
        "tooltip": {
          "hideZeros": false,
          "mode": "single",
          "sort": "none"
        }
      },
      "pluginVersion": "12.2.0",
      "targets": [
        {
          "editorMode": "code",
          "expr": "weavloader_flower_worker_online{instance=\"$instance\"}",
          "legendFormat": "{{worker}}",
          "range": true,
          "refId": "A"
        }
      ],
      "title": "Worker Health Status Timeline",
      "transformations": [
        {
          "id": "renameByRegex",
          "options": {
            "regex": "(.*)@.*",
            "renamePattern": "$1"
          }
        }
      ],
      "type": "state-timeline"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "description": "Shows the difference between the rate of all tasks received (task-received) and all tasks completed (task-succeeded) over each 1h window.\n\nRule of thumb: positive = backlog growing; ~0 = stable; negative = catching up.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "fixedColor": "yellow",
            "mode": "fixed"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "Net Tasks / s",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "barWidthFactor": 0.6,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "showValues": false,
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "dashed+area"
            }
          },
          "displayName": "Net Queue Inflow",
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              },
              {
                "color": "transparent",
                "value": 0
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 9,
        "w": 12,
        "x": 0,
        "y": 10
      },
      "id": 25,
      "options": {
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "hideZeros": false,
          "mode": "single",
          "sort": "none"
        }
      },
      "pluginVersion": "12.2.0",
      "targets": [
        {
          "editorMode": "code",
          "expr": "sum(increase(weavloader_flower_events_total{type=\"task-received\",instance=\"$instance\"}[1h])) \n- sum(increase(weavloader_flower_events_total{type=\"task-succeeded\",instance=\"$instance\"}[1h]))",
          "legendFormat": "__auto",
          "range": true,
          "refId": "A"
        }
      ],
      "title": "Task queue ingress vs completion",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "description": "Number of tasks currently executing on each worker — a direct indicator of worker load and concurrency usage.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "decimals": 0,
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              }
            ]
          },
          "unit": "none"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 3,
        "w": 12,
        "x": 12,
        "y": 10
      },
      "id": 32,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "percentChangeColorMode": "standard",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "showPercentChange": false,
        "textMode": "auto",
        "wideLayout": true
      },
      "pluginVersion": "12.2.0",
      "targets": [
        {
          "editorMode": "code",
          "expr": "weavloader_flower_worker_number_of_currently_executing_tasks{instance=\"$instance\"}",
          "legendFormat": "{{worker}}",
          "range": true,
          "refId": "A"
        }
      ],
      "title": "Active Tasks per Worker",
      "transformations": [
        {
          "id": "renameByRegex",
          "options": {
            "regex": "(.*)@.*",
            "renamePattern": "$1"
          }
        }
      ],
      "type": "stat"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "description": "Real-time depth of each celery task queue. Use this graph to monitor system load, detect growing backlogs, and confirm that queues are draining as tasks are processed. Sustained growth in a queue’s size may indicate slow consumers, blocked workers, or downstream bottlenecks.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "barWidthFactor": 0.6,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "showValues": false,
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 6,
        "w": 12,
        "x": 12,
        "y": 13
      },
      "id": 40,
      "options": {
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "hideZeros": false,
          "mode": "single",
          "sort": "none"
        }
      },
      "pluginVersion": "12.2.0",
      "targets": [
        {
          "editorMode": "code",
          "expr": "weavloader_queue_size{instance=\"$instance\"}",
          "legendFormat": "{{queue_name}}",
          "range": true,
          "refId": "A"
        }
      ],
      "title": "Celery Task Queue Size",
      "type": "timeseries"
    },
    {
      "collapsed": true,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 19
      },
      "id": 74,
      "panels": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "prometheus"
          },
          "description": "Nodes sending the most images within the selected time range. Use this graph to quickly identify the highest-traffic nodes (“top talkers”).",
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "text",
                "mode": "fixed"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisGridShow": false,
                "axisLabel": "# of Images",
                "axisPlacement": "auto",
                "fillOpacity": 80,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "lineWidth": 1,
                "scaleDistribution": {
                  "type": "linear"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 7,
            "w": 5,
            "x": 0,
            "y": 106
          },
          "id": 65,
          "options": {
            "barRadius": 0,
            "barWidth": 0.97,
            "fullHighlight": false,
            "groupWidth": 0.7,
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": false
            },
            "orientation": "horizontal",
            "showValue": "always",
            "stacking": "none",
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            },
            "xTickLabelRotation": 0,
            "xTickLabelSpacing": 300
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "editorMode": "code",
              "expr": "round(\nsum by (node_id) (increase(weavloader_sage_images_received_total{instance=\"$instance\"}[$__range])))\n",
              "format": "time_series",
              "legendFormat": "__auto",
              "range": true,
              "refId": "A"
            }
          ],
          "title": "Top talkers - Nodes",
          "transformations": [
            {
              "id": "reduce",
              "options": {
                "labelsToFields": false,
                "reducers": [
                  "lastNotNull"
                ]
              }
            },
            {
              "id": "sortBy",
              "options": {
                "fields": {},
                "sort": [
                  {
                    "desc": true,
                    "field": "Last *"
                  }
                ]
              }
            },
            {
              "id": "limit",
              "options": {
                "limitField": "5"
              }
            },
            {
              "id": "filterByValue",
              "options": {
                "filters": [
                  {
                    "config": {
                      "id": "greater",
                      "options": {
                        "value": "0"
                      }
                    },
                    "fieldName": "Last *"
                  }
                ],
                "match": "any",
                "type": "include"
              }
            }
          ],
          "type": "barchart"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "prometheus"
          },
          "description": "Total images received in each 5-hour window. Use this panel to monitor image ingestion activity across the network, identify periods of high data flow, and detect drops that could indicate connectivity issues, camera outages, or ingestion pipeline slowdowns.",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "# of Images",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "showValues": false,
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 7,
            "w": 9,
            "x": 5,
            "y": 106
          },
          "id": 41,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            }
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "editorMode": "code",
              "expr": "round(sum(increase(weavloader_sage_images_received_total{instance=\"$instance\"}[5h])))",
              "legendFormat": "images",
              "range": true,
              "refId": "A"
            }
          ],
          "title": "Total Images Received (5-Hour Window)",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "prometheus"
          },
          "description": "Shows the difference between the total number of images received and the total number of successfully processed images over each 1-hour window. Use this panel to monitor pipeline balance and detect when ingestion starts to outpace compute capacity-often an early warning of queue buildup or worker saturation.\n\nPositive values indicate that images are arriving faster than they’re being processed, which can lead to growing backlogs. \n\nNegative or near-zero values mean processing is keeping pace with incoming data.",
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "yellow",
                "mode": "fixed"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "Images",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "showValues": false,
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "dashed+area"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "transparent",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 7,
            "w": 10,
            "x": 14,
            "y": 106
          },
          "id": 66,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            }
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "editorMode": "code",
              "expr": "sum(increase(weavloader_sage_images_received_total{instance=\"$instance\"}[1h]))\n-\nsum(increase(weavloader_flower_events_total{instance=\"$instance\", task=\"job_system.tasks.process_image_task\", type=\"task-succeeded\"}[1h]))",
              "legendFormat": "Ingest–Process diff",
              "range": true,
              "refId": "A"
            }
          ],
          "title": "Image Ingestion–Processing Difference",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "prometheus"
          },
          "description": "Displays the per-second rate of Celery task events observed by Flower, grouped by event type (received, started, succeeded, failed, retried).\n\nThis shows how tasks are flowing through the pipeline—from being accepted by workers to completion or failure.\n\nUse it to spot bottlenecks or anomalies (e.g., high received but low succeeded may indicate growing queue backlog or worker issues).",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "rate of Celery task events",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "showValues": false,
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              },
              "unit": "none"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 14,
            "x": 0,
            "y": 140
          },
          "id": 23,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            }
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "editorMode": "code",
              "expr": "sum by (type) (rate(weavloader_flower_events_total{type=~\"task-(received|started|succeeded|failed|retried)\",instance=\"$instance\"}[5m]))\n",
              "legendFormat": "__auto",
              "range": true,
              "refId": "A"
            }
          ],
          "title": "Throughput of task pipeline",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "prometheus"
          },
          "description": "Average time tasks wait inside workers before execution. High values suggest worker congestion or scheduling imbalance.",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "showValues": false,
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              },
              "unit": "s"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 10,
            "x": 14,
            "y": 140
          },
          "id": 30,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            }
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "editorMode": "code",
              "expr": "avg by (task) (\n  avg_over_time(weavloader_flower_task_prefetch_time_seconds{instance=\"$instance\"}[15m])\n)",
              "legendFormat": "__auto",
              "range": true,
              "refId": "A"
            }
          ],
          "title": "Average Prefetch Wait Time by Task",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "prometheus"
          },
          "description": "This graph displays the per-second rate of weavloader_flower_events_total for the process_image_task over the past 5 minutes, grouped by event type (such as succeeded or failed). It highlights how actively the image processing task is running and helps monitor its performance and error frequency over time.",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "Event Rate",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "showValues": false,
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 14,
            "x": 0,
            "y": 148
          },
          "id": 52,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            }
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "editorMode": "code",
              "expr": "sum by (task, type) (rate(weavloader_flower_events_total{instance=\"$instance\", task=\"job_system.tasks.process_image_task\"}[5m]))",
              "legendFormat": "{{type}}",
              "range": true,
              "refId": "A"
            }
          ],
          "title": "Image Processing Task Event Rate",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "prometheus"
          },
          "description": "This graph shows the per-second rate of weavloader_flower_events_total for the monitor_data_stream task over the last 5 minutes, grouped by event type (e.g., succeeded, failed). It helps you track the activity and reliability of the data stream monitoring process, making it easier to spot performance issues or error spikes in real time.",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "Event Rate",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "showValues": false,
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 10,
            "x": 14,
            "y": 148
          },
          "id": 53,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            }
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "editorMode": "code",
              "expr": "sum by (task, type) (rate(weavloader_flower_events_total{instance=\"$instance\", task=\"job_system.tasks.monitor_data_stream\"}[5m]))",
              "legendFormat": "{{type}}",
              "range": true,
              "refId": "A"
            }
          ],
          "title": "Data Stream Monitoring Task Event Rate",
          "type": "timeseries"
        }
      ],
      "title": "Pipeline",
      "type": "row"
    },
    {
      "collapsed": true,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 20
      },
      "id": 75,
      "panels": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "prometheus"
          },
          "description": "Dead letter queue size, number of images waiting to be reprocessed after first failed pass through",
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "super-light-yellow",
                "mode": "fixed"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "# of tasks",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineStyle": {
                  "fill": "solid"
                },
                "lineWidth": 1,
                "pointSize": 3,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "showValues": false,
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "dashed+area"
                }
              },
              "displayName": "# of tasks",
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 500
                  }
                ]
              },
              "unit": "none"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 11,
            "x": 0,
            "y": 184
          },
          "id": 21,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": false
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            }
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "editorMode": "code",
              "expr": "weavloader_dlq_size{instance=\"$instance\"}",
              "legendFormat": "__auto",
              "range": true,
              "refId": "A"
            }
          ],
          "title": "DLQ size",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "prometheus"
          },
          "description": "Highlights the top five nodes that have discarded the most Dead Letter Queue (DLQ) tasks during the current dashboard/panel time range. Each bar represents the total number of DLQ tasks permanently thrown away by that node. Use this panel to quickly identify poison sources (problematic nodes) that repeatedly send invalid data, trigger processing errors, or cause downstream failures. Investigate these nodes to prevent further poison-message buildup and improve system reliability.",
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "text",
                "mode": "thresholds"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisGridShow": false,
                "axisLabel": "# of Tasks Discarded",
                "axisPlacement": "auto",
                "fillOpacity": 80,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "lineWidth": 1,
                "scaleDistribution": {
                  "type": "linear"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "text",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 30
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 5,
            "x": 11,
            "y": 184
          },
          "id": 68,
          "options": {
            "barRadius": 0,
            "barWidth": 0.97,
            "colorByField": "Last *",
            "fullHighlight": false,
            "groupWidth": 0.7,
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": false
            },
            "orientation": "horizontal",
            "showValue": "always",
            "stacking": "none",
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            },
            "xField": "Field",
            "xTickLabelRotation": 0,
            "xTickLabelSpacing": 300
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "editorMode": "code",
              "expr": "round(sum by (node_id) (increase(weavloader_dlq_tasks_thrown_away_total{instance=\"$instance\"}[$__range])))\n",
              "format": "time_series",
              "legendFormat": "__auto",
              "range": true,
              "refId": "A"
            }
          ],
          "title": "Poison Sources - Top 5 Nodes Discarding DLQ Tasks ",
          "transformations": [
            {
              "id": "reduce",
              "options": {
                "labelsToFields": false,
                "reducers": [
                  "lastNotNull"
                ]
              }
            },
            {
              "id": "sortBy",
              "options": {
                "fields": {},
                "sort": [
                  {
                    "desc": true,
                    "field": "Last *"
                  }
                ]
              }
            },
            {
              "id": "limit",
              "options": {
                "limitField": "5"
              }
            },
            {
              "id": "filterByValue",
              "options": {
                "filters": [
                  {
                    "config": {
                      "id": "greater",
                      "options": {
                        "value": 0
                      }
                    },
                    "fieldName": "Last *"
                  }
                ],
                "match": "any",
                "type": "include"
              }
            }
          ],
          "type": "barchart"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "prometheus"
          },
          "description": "Displays the total number of Dead Letter Queue (DLQ) tasks that were permanently discarded over each 5-hour period. This metric counts how many tasks could not be successfully reprocessed and were ultimately thrown away. Use this graph to monitor long-term DLQ health, spot recurring discard spikes, and identify periods when unrecoverable task errors increase — which may point to persistent data issues, bad inputs, or system misconfigurations.",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "# of Tasks Discarded",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "showValues": false,
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "dashed+area"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 30
                  }
                ]
              },
              "unit": "none"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 8,
            "x": 16,
            "y": 184
          },
          "id": 38,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            }
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "editorMode": "code",
              "expr": "round(sum(increase(weavloader_dlq_tasks_thrown_away_total{instance=\"$instance\"}[5h])))",
              "legendFormat": "DLQ Tasks",
              "range": true,
              "refId": "A"
            }
          ],
          "title": "DLQ Discards (5h Total)",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "prometheus"
          },
          "description": "Shows the per-second rate of Dead Letter Queue (DLQ) task reprocessing attempts over the past 5 minutes, grouped by status. This graph highlights how actively the system is draining the DLQ and whether those attempts are succeeding or failing. If both success and failure are zero it means to no DLQ task are being processed.",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "showValues": false,
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "red",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": [
              {
                "matcher": {
                  "id": "byName",
                  "options": "{instance=\"dev-weavloader-metrics.nrp-nautilus.io\", job=\"weavloader-metrics\", status=\"failure\"}"
                },
                "properties": [
                  {
                    "id": "color",
                    "value": {
                      "fixedColor": "red",
                      "mode": "fixed"
                    }
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "{instance=\"dev-weavloader-metrics.nrp-nautilus.io\", job=\"weavloader-metrics\", status=\"success\"}"
                },
                "properties": [
                  {
                    "id": "color",
                    "value": {
                      "fixedColor": "green",
                      "mode": "fixed"
                    }
                  }
                ]
              }
            ]
          },
          "gridPos": {
            "h": 7,
            "w": 11,
            "x": 0,
            "y": 192
          },
          "id": 63,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            }
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "editorMode": "code",
              "expr": "sum by (status) (rate(weavloader_dlq_tasks_reprocessed_total{instance=\"$instance\"}[5m]))",
              "legendFormat": "__auto",
              "range": true,
              "refId": "A"
            }
          ],
          "title": "DLQ Reprocess Rate",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "prometheus"
          },
          "description": "Share of DLQ reprocessing attempts that failed; rising values suggest recurring or unrecoverable task errors.",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "Failure Ratio",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "showValues": false,
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "dashed+area"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 0.3
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 7,
            "w": 13,
            "x": 11,
            "y": 192
          },
          "id": 37,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            }
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "editorMode": "code",
              "expr": "sum(rate(weavloader_dlq_tasks_reprocessed_total{status=\"failure\",instance=\"$instance\"}[5m]))\n/\nsum(rate(weavloader_dlq_tasks_reprocessed_total{instance=\"$instance\"}[5m]))",
              "legendFormat": "DLQ",
              "range": true,
              "refId": "A"
            }
          ],
          "title": "DLQ Reprocess Failure Ratio",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "prometheus"
          },
          "description": "This graph shows the per-second rate of weavloader_flower_events_total for the handle_dlq task over the last 5 minutes, grouped by event type (e.g., succeeded, failed). It visualizes how frequently the DLQ (Dead Letter Queue) handling task processes events, helping identify trends or spikes in failures and successful executions.",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "Event Rate",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "showValues": false,
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 5,
            "w": 11,
            "x": 0,
            "y": 199
          },
          "id": 51,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            }
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "editorMode": "code",
              "expr": "sum by (task, type) (rate(weavloader_flower_events_total{instance=\"$instance\", task=\"job_system.tasks.handle_dlq\"}[5m]))",
              "legendFormat": "{{type}}",
              "range": true,
              "refId": "A"
            }
          ],
          "title": "DLQ Handling Task Event Rate",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "prometheus"
          },
          "description": "This graph displays the per-second rate of weavloader_flower_events_total for the process_dlq_message task over the past 5 minutes, grouped by event type (such as succeeded or failed). It provides visibility into how frequently DLQ (Dead Letter Queue) messages are being processed and helps detect issues or backlogs in message recovery workflows.",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "Event Rate",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "showValues": false,
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 5,
            "w": 13,
            "x": 11,
            "y": 199
          },
          "id": 54,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            }
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "editorMode": "code",
              "expr": "sum by (task, type) (rate(weavloader_flower_events_total{instance=\"$instance\", task=\"job_system.tasks.process_dlq_message\"}[5m]))",
              "legendFormat": "{{type}}",
              "range": true,
              "refId": "A"
            }
          ],
          "title": "DLQ Message Processing Task Event Rate",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "prometheus"
          },
          "description": "Displays all Dead Letter Queue (DLQ) tasks that were permanently discarded during the selected time range. \n\nDLQ task = one image.\n\nEach row shows the originating node, job, task, and camera associated with the discarded task, along with the total count of thrown-away tasks.\n\nUse this table to identify the specific sources that are repeatedly producing unrecoverable or invalid data. A growing count here signals potential “poison message” issues that may require data-quality or configuration fixes. You can also use this table to find if certain images were discarded and are not in the vector database.",
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "text",
                "mode": "thresholds"
              },
              "custom": {
                "align": "auto",
                "cellOptions": {
                  "type": "auto"
                },
                "filterable": true,
                "footer": {
                  "reducers": []
                },
                "inspect": false,
                "wrapHeaderText": false,
                "wrapText": true
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 10
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 24,
            "x": 0,
            "y": 204
          },
          "id": 78,
          "options": {
            "cellHeight": "sm",
            "enablePagination": true,
            "frameIndex": 36,
            "showHeader": true,
            "sortBy": [
              {
                "desc": true,
                "displayName": "Dropped Images"
              }
            ]
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "editorMode": "code",
              "expr": "round(sum by (node_id, exported_job, task, camera) (\n  increase(weavloader_dlq_tasks_thrown_away_total{instance=\"$instance\"}[$__range])\n) > 0)",
              "legendFormat": "__auto",
              "range": true,
              "refId": "A"
            }
          ],
          "title": "Discarded Images (DLQ Tasks)",
          "transformations": [
            {
              "id": "timeSeriesTable",
              "options": {
                "A": {
                  "timeField": "Time"
                }
              }
            },
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {
                  "Trend #A": 4,
                  "camera": 3,
                  "exported_job": 1,
                  "node_id": 0,
                  "task": 2
                },
                "renameByName": {
                  "Trend #A": "Dropped Images",
                  "exported_job": "job",
                  "node_id": "vsn",
                  "task": ""
                }
              }
            }
          ],
          "type": "table"
        }
      ],
      "title": "Dead Letter Queue",
      "type": "row"
    },
    {
      "collapsed": true,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 21
      },
      "id": 76,
      "panels": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "prometheus"
          },
          "description": "This panel tracks the fraction of tasks that failed within the observed window. The ratio is computed as the rate of flower_events_total{event=\"task-failed\"} divided by the combined rate of task-succeeded and task-failed events.\n\nValues close to 0 = healthy (few failures).\nValues approaching 1 = many failures or systemic issues in workers or tasks.",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "thresholds"
              },
              "mappings": [],
              "noValue": "0%",
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 0.3
                  }
                ]
              },
              "unit": "percentunit"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 7,
            "x": 0,
            "y": 31
          },
          "id": 24,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "editorMode": "code",
              "expr": "sum(rate(weavloader_flower_events_total{type=\"task-failed\",instance=\"$instance\"}[5m]))\n/\nsum(rate(weavloader_flower_events_total{type=~\"task-(succeeded|failed)\",instance=\"$instance\"}[5m]))",
              "legendFormat": "__auto",
              "range": true,
              "refId": "A"
            }
          ],
          "title": "Celery Tasks Error Ratio",
          "type": "stat"
        },
        {
          "datasource": {
            "uid": "prometheus"
          },
          "description": "Displays the rate of weavloader errors over time, grouped by component and error type. Useful for quickly identifying which parts of the system are generating errors and the types.",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "Error rate",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineStyle": {
                  "fill": "solid"
                },
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "showValues": false,
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "dashed+area"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 0.3
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 9,
            "w": 17,
            "x": 7,
            "y": 31
          },
          "id": 22,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            }
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "editorMode": "code",
              "expr": "sum by (component, error_type) (\n  rate(weavloader_errors_total{instance=\"$instance\"}[5m])\n)",
              "legendFormat": "__auto",
              "range": true,
              "refId": "A"
            }
          ],
          "title": "Error Rates by Component & Error Type",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "prometheus"
          },
          "description": "Rate of task failures per worker (tasks/s). Highlights unhealthy or unstable workers.",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "tasks/s",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "showValues": false,
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "dashed+area"
                }
              },
              "mappings": [],
              "noValue": "0",
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 0.3
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 5,
            "w": 7,
            "x": 0,
            "y": 35
          },
          "id": 26,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            }
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "editorMode": "code",
              "expr": "sum by (worker) (rate(weavloader_flower_events_total{type=~\"task-(failed)\",instance=\"$instance\"}[5m]))",
              "legendFormat": "__auto",
              "range": true,
              "refId": "A"
            }
          ],
          "title": "Per-worker failure rates",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "prometheus"
          },
          "description": "Rate of task retries grouped by type and reason — helps pinpoint unstable tasks or recurring failure causes.",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "Retry Rate",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "showValues": false,
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "dashed+area"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 0.3
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 9,
            "w": 24,
            "x": 0,
            "y": 40
          },
          "id": 45,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            }
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "editorMode": "code",
              "expr": "sum by (task, retry_reason) (\n  rate(weavloader_tasks_retried_total{instance=\"$instance\"}[5m])\n)",
              "legendFormat": "__auto",
              "range": true,
              "refId": "A"
            }
          ],
          "title": "Retries by Task & Reason",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "prometheus"
          },
          "description": "Displays the percentage of failed model inference operations over the past 5 minutes, grouped by operation type (e.g., embedding, caption). If no failures occur for an operation, its failure ratio is shown as 0. Use this panel to monitor inference reliability across different model operations and quickly identify spikes in failure rates that may indicate degraded model performance or backend issues.",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "Failure Ratio",
                "axisPlacement": "auto",
                "axisSoftMax": 1,
                "axisSoftMin": 0,
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "showValues": false,
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "dashed+area"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 0.3
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 9,
            "w": 12,
            "x": 0,
            "y": 49
          },
          "id": 56,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            }
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "editorMode": "code",
              "expr": "(\n  sum by (operation) (\n    rate(weavloader_model_inference_total{status=\"failure\", instance=\"$instance\"}[5m])\n  )\n  OR on(operation)\n  0 * sum by (operation) (\n    rate(weavloader_model_inference_total{instance=\"$instance\"}[5m])\n  )\n)\n/\nclamp_min(\n  sum by (operation) (\n    rate(weavloader_model_inference_total{instance=\"$instance\"}[5m])\n  ),\n  1e-9\n)\n",
              "legendFormat": "__auto",
              "range": true,
              "refId": "A"
            }
          ],
          "title": "Inference Failure Ratio",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "prometheus"
          },
          "description": "Shows the fraction of Weaviate insert operations that failed within the last 5 minutes (failed inserts / total inserts). A higher ratio indicates instability or write errors in the Weaviate ingestion path. Use this panel to monitor data ingestion reliability and detect spikes in insert failures early.",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "Failure Ratio",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "showValues": false,
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "dashed+area"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 0.3
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 9,
            "w": 12,
            "x": 12,
            "y": 49
          },
          "id": 47,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            }
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "editorMode": "code",
              "expr": "sum(rate(weavloader_weaviate_operations_total{status=\"failure\",operation=\"insert\",instance=\"$instance\"}[5m]))\n/\nsum(rate(weavloader_weaviate_operations_total{operation=\"insert\",instance=\"$instance\"}[5m]))",
              "legendFormat": "insert",
              "range": true,
              "refId": "A"
            }
          ],
          "title": "Weaviate Insert Failure Ratio",
          "type": "timeseries"
        }
      ],
      "title": "Error Stats",
      "type": "row"
    },
    {
      "collapsed": true,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 22
      },
      "id": 73,
      "panels": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "prometheus"
          },
          "description": "Shows the average runtime for the process_image_task across the selected time range. The average value represents typical task performance.",
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "green",
                "mode": "fixed"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              },
              "unit": "s"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 6,
            "x": 0,
            "y": 267
          },
          "id": 71,
          "options": {
            "colorMode": "value",
            "graphMode": "none",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "value_and_name",
            "wideLayout": true
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "datasource": {
                "type": "prometheus",
                "uid": "prometheus"
              },
              "editorMode": "code",
              "expr": "sum by (instance) (\n  increase(weavloader_flower_task_runtime_seconds_sum{task=\"job_system.tasks.process_image_task\",instance=\"$instance\"}[$__range])\n)\n/\nsum by (instance) (\n  increase(weavloader_flower_task_runtime_seconds_count{task=\"job_system.tasks.process_image_task\", instance=\"$instance\"}[$__range])\n)",
              "hide": false,
              "instant": false,
              "legendFormat": "avg",
              "range": true,
              "refId": "B"
            }
          ],
          "title": "Image Processing Runtime",
          "type": "stat"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "prometheus"
          },
          "description": "Displays the average and 90th-percentile (P90) latency for successful Embedding model inference operations for over the selected time range. Use this panel to monitor both typical and the 90th-percentile latency, showing how long the slower 10 % of inferences take. A widening gap between average and P90 indicates increasing variability or occasional slow responses.",
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "green",
                "mode": "fixed"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              },
              "unit": "s"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 6,
            "x": 6,
            "y": 267
          },
          "id": 57,
          "options": {
            "colorMode": "value",
            "graphMode": "none",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "value_and_name",
            "wideLayout": true
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "datasource": {
                "type": "prometheus",
                "uid": "prometheus"
              },
              "editorMode": "code",
              "expr": "sum by (instance, model_name) (\n  increase(weavloader_model_inference_duration_seconds_sum{operation=\"embedding\",status=\"success\",instance=\"$instance\"}[$__range])\n)\n/\nsum by (instance, model_name) (\n  increase(weavloader_model_inference_duration_seconds_count{operation=\"embedding\",status=\"success\",instance=\"$instance\"}[$__range])\n)",
              "hide": false,
              "instant": false,
              "legendFormat": "{{model_name}} avg",
              "range": true,
              "refId": "B"
            },
            {
              "datasource": {
                "type": "prometheus",
                "uid": "prometheus"
              },
              "editorMode": "code",
              "expr": "histogram_quantile(\n  0.9,\n  sum by (model_name, le) (\n    increase(weavloader_model_inference_duration_seconds_bucket{\n      operation=\"embedding\", instance=\"$instance\", status=\"success\"\n    }[$__range])\n  )\n)",
              "hide": false,
              "instant": false,
              "legendFormat": "{{model_name}} P90",
              "range": true,
              "refId": "A"
            }
          ],
          "title": "Embedding Latency (Avg / P90)",
          "type": "stat"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "prometheus"
          },
          "description": "Displays the average and 90th-percentile (P90) latency for successful Caption model inference operations for over the selected time range. Use this panel to monitor both typical and the 90th-percentile latency, showing how long the slower 10 % of inferences take. A widening gap between average and P90 indicates increasing variability or occasional slow responses.",
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "green",
                "mode": "fixed"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              },
              "unit": "s"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 5,
            "x": 12,
            "y": 267
          },
          "id": 59,
          "options": {
            "colorMode": "value",
            "graphMode": "none",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "value_and_name",
            "wideLayout": true
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "datasource": {
                "type": "prometheus",
                "uid": "prometheus"
              },
              "editorMode": "code",
              "expr": "sum by (instance, model_name)  (\n  increase(weavloader_model_inference_duration_seconds_sum{operation=\"caption\",status=\"success\",instance=\"$instance\"}[$__range])\n)\n/\nsum by (instance, model_name)  (\n  increase(weavloader_model_inference_duration_seconds_count{operation=\"caption\",status=\"success\",instance=\"$instance\"}[$__range])\n)",
              "hide": false,
              "instant": false,
              "legendFormat": "{{model_name}} avg",
              "range": true,
              "refId": "B"
            },
            {
              "datasource": {
                "type": "prometheus",
                "uid": "prometheus"
              },
              "editorMode": "code",
              "expr": "histogram_quantile(\n  0.9,\n  sum by (model_name, le) (\n    increase(weavloader_model_inference_duration_seconds_bucket{\n      operation=\"caption\", instance=\"$instance\", status=\"success\"\n    }[$__range])\n  )\n)\n",
              "hide": false,
              "instant": false,
              "legendFormat": "{{model_name}} P90",
              "range": true,
              "refId": "A"
            }
          ],
          "title": "Caption Latency (Avg / P90)",
          "type": "stat"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "prometheus"
          },
          "description": "Displays the average and 90th-percentile (P90) latency for Weaviate insert operations for over the selected time range. Use this panel to monitor both typical and the 90th-percentile latency, showing how long the slower 10% of insert operations take. A widening gap between average and P90 indicates increasing variability or occasional slow responses.",
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "green",
                "mode": "fixed"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              },
              "unit": "s"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 6,
            "x": 17,
            "y": 267
          },
          "id": 62,
          "options": {
            "colorMode": "value",
            "graphMode": "none",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "value_and_name",
            "wideLayout": true
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "datasource": {
                "type": "prometheus",
                "uid": "prometheus"
              },
              "editorMode": "code",
              "expr": "sum by (instance) (\n  increase(weavloader_weaviate_operation_duration_seconds_sum{operation=\"insert\",status=\"success\",instance=\"$instance\"}[$__range])\n)\n/\nsum by (instance) (\n  increase(weavloader_weaviate_operation_duration_seconds_count{operation=\"insert\",status=\"success\",instance=\"$instance\"}[$__range])\n)",
              "hide": false,
              "instant": false,
              "legendFormat": "avg",
              "range": true,
              "refId": "B"
            },
            {
              "datasource": {
                "type": "prometheus",
                "uid": "prometheus"
              },
              "editorMode": "code",
              "expr": "histogram_quantile(\n  0.9,\n  sum by (model_name, le) (\n    increase(weavloader_weaviate_operation_duration_seconds_bucket{\n      operation=\"insert\", instance=\"$instance\", status=\"success\"\n    }[$__range])\n  )\n)",
              "hide": false,
              "instant": false,
              "legendFormat": "P90",
              "range": true,
              "refId": "A"
            }
          ],
          "title": "Weaviate Insert Latency (Avg / P90)",
          "type": "stat"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "prometheus"
          },
          "description": "Compares the average end-to-end runtime of the process_image_task with the average latency of individual model inference operations - Embedding and Caption - over a 5-minute window. Each bar represents the mean execution time (in seconds) during the interval. Use this panel to monitor how inference performance contributes to overall task latency",
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "green",
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "Duration",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "bars",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "showValues": false,
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "fieldMinMax": false,
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              },
              "unit": "s"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 7,
            "w": 12,
            "x": 0,
            "y": 271
          },
          "id": 61,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            }
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "datasource": {
                "type": "prometheus",
                "uid": "prometheus"
              },
              "editorMode": "code",
              "expr": " avg by (instance)(\n  rate(weavloader_flower_task_runtime_seconds_sum{task=\"job_system.tasks.process_image_task\",instance=\"$instance\"}[5m]))\n  /\navg by (instance)( \nrate(weavloader_flower_task_runtime_seconds_count{task=\"job_system.tasks.process_image_task\",instance=\"$instance\"}[5m])\n)",
              "hide": false,
              "instant": false,
              "legendFormat": "Runtime",
              "range": true,
              "refId": "B"
            },
            {
              "datasource": {
                "type": "prometheus",
                "uid": "prometheus"
              },
              "editorMode": "code",
              "expr": "(\n  rate(weavloader_model_inference_duration_seconds_sum{operation=\"embedding\", status=\"success\", instance=\"$instance\"}[5m])\n  /\n  rate(weavloader_model_inference_duration_seconds_count{operation=\"embedding\", status=\"success\", instance=\"$instance\"}[5m])\n)",
              "hide": false,
              "instant": false,
              "legendFormat": "{{model_name}}",
              "range": true,
              "refId": "A"
            },
            {
              "datasource": {
                "type": "prometheus",
                "uid": "prometheus"
              },
              "editorMode": "code",
              "expr": "(\n  rate(weavloader_model_inference_duration_seconds_sum{operation=\"caption\", status=\"success\", instance=\"$instance\"}[5m])\n  /\n  rate(weavloader_model_inference_duration_seconds_count{operation=\"caption\", status=\"success\", instance=\"$instance\"}[5m])\n)",
              "hide": false,
              "instant": false,
              "legendFormat": "{{model_name}}",
              "range": true,
              "refId": "C"
            }
          ],
          "title": "Runtime vs Inference Latency",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "prometheus"
          },
          "description": "Shows the share of total latency spent waiting (Prefetch) vs running (Runtime) for job_system.tasks.process_image_task.\n100% stacked bars highlight how much of each task’s time is queue delay vs execution.",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "bars",
                "fillOpacity": 100,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "showValues": false,
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "percent"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              },
              "unit": "s"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 7,
            "w": 11,
            "x": 12,
            "y": 271
          },
          "id": 29,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            }
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "editorMode": "code",
              "exemplar": false,
              "expr": "sum without(worker) (\n  rate(weavloader_flower_task_runtime_seconds_sum{task=\"job_system.tasks.process_image_task\",instance=\"$instance\"}[5m])\n)\n/\nsum without(worker) (\n  rate(weavloader_flower_task_runtime_seconds_count{task=\"job_system.tasks.process_image_task\",instance=\"$instance\"}[5m])\n)\n",
              "legendFormat": "Runtime",
              "range": true,
              "refId": "A"
            },
            {
              "datasource": {
                "type": "prometheus",
                "uid": "prometheus"
              },
              "editorMode": "code",
              "expr": "avg without(worker) (\n  avg_over_time(weavloader_flower_task_prefetch_time_seconds{task=\"job_system.tasks.process_image_task\",instance=\"$instance\"}[5m])\n)",
              "hide": false,
              "instant": false,
              "legendFormat": "Prefetch wait",
              "range": true,
              "refId": "B"
            }
          ],
          "title": "Task Latency Composition — Process Image Task",
          "type": "timeseries"
        }
      ],
      "title": "Latency",
      "type": "row"
    }
  ],
  "preload": false,
  "refresh": "30s",
  "schemaVersion": 42,
  "tags": [
    "weavloader",
    "monitoring",
    "Image Search"
  ],
  "templating": {
    "list": [
      {
        "allowCustomValue": false,
        "current": {
          "text": "dev-weavloader-metrics.nrp-nautilus.io",
          "value": "dev-weavloader-metrics.nrp-nautilus.io"
        },
        "definition": "label_values(weavloader_component_health,instance)",
        "description": "The Deployment environment to retrieve metrics from (ex Dev, Prod)",
        "includeAll": false,
        "label": "Instance",
        "name": "instance",
        "options": [],
        "query": {
          "qryType": 1,
          "query": "label_values(weavloader_component_health,instance)",
          "refId": "PrometheusVariableQueryEditor-VariableQuery"
        },
        "refresh": 2,
        "regex": "",
        "sort": 1,
        "type": "query"
      }
    ]
  },
  "time": {
    "from": "now-1h",
    "to": "now"
  },
  "timepicker": {},
  "timezone": "",
  "title": "Weavloader",
  "uid": "weavloader-dashboard",
  "version": 28
}